version: "3.9"

services:
  redis:
    image: redis:latest
    command: ["redis-server", "--appendonly", "yes"]

  dw1:
    build:
      context: .
      dockerfile: Dockerfile
    command: ["labs.partea1.DWServer"]  # ⬅️ Suprascrie CMD-ul default
    environment:
      PORT: 8081
      DB_URL: ${DB_URL}
      DB_USER: ${DB_USER}
      DB_PASS: ${DB_PASS}
    depends_on:
      - redis

  proxy:
    build:
      context: .
      dockerfile: Dockerfile
    # ⬅️ NU pune command aici - va folosi CMD default (ProxyServer)
    environment:
      PORT: 8080
      DW_SERVERS: http://dw1:8081
      REDIS_HOST: redis
      REDIS_PORT: 6379
    depends_on:
      - dw1
      - redis